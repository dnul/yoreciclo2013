if(typeof(usig)=="undefined"){usig={}}usig.AjaxComponent=jQuery.Class.create({init:function(d,a,c){this.name=d;var b=window.location.host==usig.parseUri(a).authority?"ajax":"jsonp";this.defaultParams={type:"GET",url:a,dataType:b};jQuery.jsonp.setup({callbackParameter:"callback",pageCache:true,dataFilter:function(e){return JSON.parse(JSON.stringify(e))}});this.opts=$.extend({},usig.AjaxComponent.defaults,c);if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") dataType: "+b)}},mkRequest:function(e,h,f,c){var b=null;function a(k,l){clearTimeout(b);if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Ajax Request Success")}if(typeof(this.opts.afterServerResponse)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterServerResponse")}this.opts.afterServerResponse()}l(k)}function g(l,n,k){if(l!=null&&l.readyState!=0&&l.readyState!=4){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Aborting request...")}l.abort();if(typeof(this.opts.afterAbort)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterAbort")}this.opts.afterAbort()}if(this.opts.maxRetries>k){var m=(n.dataType=="jsonp")?$.jsonp(n):$.ajax(n);if(typeof(this.opts.afterRetry)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterRetry")}this.opts.afterRetry()}if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") Retrying request...")}b=setTimeout(g.createDelegate(this,[m,j,(k+1)]),this.opts.serverTimeout)}else{if(this.opts.debug){usig.debug("ERROR: Se alcanzo el maximo numero de reintentos al servidor sin exito.")}if(typeof(n.error)=="function"){n.error("Se produjo un error al intentar acceder al servidor: "+n.url)}}}}if(typeof(h)!="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") success tiene que ser una funciÃ³n que acepte como parÃ¡metro el dato solicitado porque puede no estar inmediatamente disponible.")}return}if(typeof(f)!="undefined"&&typeof(f)!="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") error tiene que ser una funciÃ³n.")}return}var j=$.extend(true,{},this.defaultParams,{success:a.createDelegate(this,[h],1),error:f,data:e});if(c){j.url=c}var d=(j.dataType=="jsonp")?$.jsonp(j):$.ajax(j);if(typeof(this.opts.afterServerRequest)=="function"){if(this.opts.debug){usig.debug("usig.AjaxComponent("+this.name+") calling afterServerRequest")}this.opts.afterServerRequest()}if(this.opts.serverTimeout>0){b=setTimeout(g.createDelegate(this,[d,j,0]),this.opts.serverTimeout)}return{req:d,abort:function(){clearTimeout(b);d.abort()}}},setOptions:function(a){this.opts=$.extend({},this.opts,a)},getOptions:function(){return this.opts}});usig.AjaxComponent.defaults={debug:false,serverTimeout:30000,maxRetries:1};if(typeof(usig)=="undefined"){usig={}}usig.Punto=function(b,a){this.x=this.lon=b;this.y=this.lat=a;this.getX=function(){return this.x};this.getY=function(){return this.y};this.toJson=function(){return'{ "x":'+this.x+', "y": '+this.y+" }"};this.toString=function(){return"("+this.x+", "+this.y+")"}};usig.Punto.fromWkt=function(b){var c=/^POINT *\(([0-9]+\.[0-9]+) ([0-9]+\.[0-9]+)\)$/;var a=null;if(resMatch=b.match(c)){a=new usig.Punto(resMatch[1],resMatch[2])}return a};usig.Punto.fromPunto=function(a){return new usig.Punto(a.getX(),a.getY())};if(typeof(usig)=="undefined"){usig={}}usig.SeccionCatastral=function(a){this.codigoSeccion=a;this.descripcion="CÃ³digo SecciÃ³n";this.toString=function(){return this.codigoSeccion}};if(typeof(usig)=="undefined"){usig={}}usig.ManzanaCatastral=function(a){this.codigoManzana=a;this.descripcion="CÃ³digo SecciÃ³n-Manzana";this.toString=function(){return this.codigoManzana}};if(typeof(usig)=="undefined"){usig={}}usig.ParcelaCatastral=function(a){this.smp=a.smp;this.pm=a.pm;this.punto=usig.Punto.fromWkt(a.centroide);if(this.pm!=""){this.descripcion="CÃ³digo Partida-Matriz"}else{this.descripcion="CÃ³digo SecciÃ³n-Manzana-Parcela"}this.getPunto=function(){return this.punto};this.toString=function(){if(this.pm!=""){return this.pm}else{return this.smp}}};if(typeof(usig)=="undefined"){usig={}}usig.IndiceCatastral=usig.AjaxComponent.extend({init:function(a){var b=$.extend({},usig.IndiceCatastral.defaults,a);this._super("IndiceCatastral",usig.IndiceCatastral.defaults.server,b);this.showDebug("Creando instancia de usig.IndiceCatastral")},buscar:function(j,k,f,c){var a=/^([0-9]{2})-([0-9]{3}[A-Z]?)-([A-Z0-9]{0,4})$/;var g=/^([0-9]{2})-([0-9]{0,3}|[0-9]{3}[A-Z])$/;var l=/^([0-9]{1,6})$/;var b=/^([0-9]{1,2})$/;var h=/^([1-9][0-9]{0,5})$/;var j=j.toUpperCase();var c=c!=undefined?c:this.opts.maxSuggestions;this.showDebug("-=-=-= Busqueda: "+j+" =-=-=-");function e(n,o,m){var p=[];var m=Math.min(n.datos.length,m);for(i=0;i<m;i++){if(n.tipo=="P"){p.push(new usig.ParcelaCatastral(n.datos[i]))}else{if(n.tipo=="M"){p.push(new usig.ManzanaCatastral(n.seccion+"-"+n.datos[i]))}else{if(n.tipo=="S"){p.push(new usig.SeccionCatastral(n.datos[i]))}}}}this.showDebug(p);if(typeof(o)=="function"){o(p)}}if((resMatch=j.match(a))&&this.opts.buscarSMP){this.lastRequest=this.mkRequest(null,e.createDelegate(this,[k,c],1),f,this.opts.server+"smp/"+resMatch[1]+"/"+resMatch[2]+"/"+resMatch[3])}else{if((resMatch=j.match(g))&&this.opts.buscarSMP){this.lastRequest=this.mkRequest(null,e.createDelegate(this,[k,c],1),f,this.opts.server+"smp/"+resMatch[1]+"/"+resMatch[2])}else{if(resMatch=j.match(l)){var d=false;if((j.match(h))&&this.opts.buscarPM){this.lastRequest=this.mkRequest(null,e.createDelegate(this,[k,c],1),f,this.opts.server+"pm/"+resMatch[1]);d=true}if((j.match(b))&&this.opts.buscarSMP){this.lastRequest=this.mkRequest(null,e.createDelegate(this,[k,c],1),f,this.opts.server+"smp/"+resMatch[1]);d=true}if(!d){throw (new usig.IndiceCatastral.WrongParameters)}}else{if(j==""&&this.opts.buscarSMP){this.lastRequest=this.mkRequest(null,e.createDelegate(this,[k,c],1),f,this.opts.server+"smp/")}else{throw (new usig.IndiceCatastral.WrongParameters())}}}}return},abort:function(){if(this.lastRequest){this.lastRequest.abort();this.lastRequest=null;if(typeof(this.opts.afterAbort)=="function"){this.opts.afterAbort()}}},showDebug:function(a){if(this.opts.debug){usig.debug(a)}}});usig.IndiceCatastral.WrongParameters=function(){this.msg="Los parametros ingresados son incorrectos.";this.getErrorMessage=function(){return this.msg}};usig.IndiceCatastral.defaults={debug:false,server:"http://inventario.usig.buenosaires.gob.ar/indice_catastral/",maxSuggestions:10,buscarSMP:true,buscarPM:true};if(typeof(usig)=="undefined"){usig={}}usig.SuggesterCatastro=usig.Suggester.extend({init:function(a){var b=$.extend({},usig.SuggesterCatastro.defaults,a);this._super("Catastro",b);if(!this.opts.indiceCatastral){this.opts.indiceCatastral=new usig.IndiceCatastral(b);this.cleanList.push(this.opts.indiceCatasral)}},getSuggestions:function(c,e,d){var a=d!=undefined?d:this.opts.maxSuggestions;try{this.opts.indiceCatastral.buscar(c,e,function(){},a)}catch(b){e(b)}},getGeoCoding:function(a,b){if(!(a instanceof usig.ParcelaCatastral)){b(new usig.Suggester.GeoCodingTypeError())}else{b(a.getPunto())}},abort:function(){this.opts.indiceCatastral.abort()},ready:function(){return true},setOptions:function(a){this._super(a);this.opts.indiceCatastral.setOptions(a)}});usig.SuggesterCatastro.defaults={debug:false,serverTimeout:5000,maxRetries:5,maxSuggestions:10};usig.registerSuggester("Catastro",usig.SuggesterCatastro);